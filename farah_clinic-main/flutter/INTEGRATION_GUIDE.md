# دليل التكامل مع الباك إند الجديد

## نظرة عامة
تم تحديث تطبيق Flutter للعمل مع الباك إند الجديد المبني بـ FastAPI و MongoDB. هذا الدليل يوضح التغييرات المطلوبة والتكامل.

## التغييرات الرئيسية

### 1. إعدادات API
- تم تحديث `api_config.dart` لإضافة مسارات API الجديدة
- إضافة مسارات للمصادقة والمرضى والمدفوعات

### 2. خدمة API
- تحديث `api_service.dart` لاستخدام endpoints الجديدة
- تحديث نظام المصادقة لاستخدام JWT tokens
- إضافة دعم لـ bootstrap endpoint

### 3. نماذج البيانات
- تحديث `patient.dart` لتتوافق مع schemas الجديدة
- تحديث `payment.dart` لإضافة patient_id
- تحديث أسماء الحقول لتتوافق مع الباك إند

### 4. المصادقة
- تحديث `app_provider.dart` لاستخدام JWT tokens
- تحسين التحقق من صحة التوكن
- إضافة دعم للتخزين الآمن للتوكن

## الباك إند الجديد

### الميزات
- FastAPI مع MongoDB
- نظام مصادقة JWT
- APIs منظمة مع schemas
- دعم للفلترة والبحث
- إحصائيات شاملة

### Endpoints الرئيسية
- `POST /auth/login` - تسجيل الدخول
- `GET /auth/me` - معلومات المستخدم
- `GET /bootstrap` - جلب جميع البيانات
- `GET /patients/` - قائمة المرضى
- `POST /patients/` - إضافة مريض جديد
- `GET /patients/statistics/summary` - الإحصائيات

## كيفية التشغيل

### 1. تشغيل الباك إند
```bash
cd backend
python -m uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

### 2. تشغيل Flutter
```bash
cd flutter
flutter run
```

## بيانات تسجيل الدخول الافتراضية
- اسم المستخدم: `admin`
- كلمة المرور: `admin123`

## ملاحظات مهمة

### التوافق مع الكود القديم
- تم الحفاظ على التوافق مع الكود القديم قدر الإمكان
- تم إضافة طرق `toMap()` و `fromMap()` للتوافق
- تم تحديث أسماء الحقول تدريجياً

### الأمان
- استخدام JWT tokens للمصادقة
- تخزين آمن للتوكن
- التحقق من صحة التوكن عند كل طلب

### الأداء
- استخدام bootstrap endpoint لتحميل البيانات دفعة واحدة
- تحسين استعلامات قاعدة البيانات
- دعم للفلترة والبحث

## استكشاف الأخطاء

### مشاكل الاتصال
1. تأكد من تشغيل الباك إند على المنفذ 8000
2. تحقق من إعدادات CORS
3. تأكد من صحة عنوان IP في `api_config.dart`

### مشاكل المصادقة
1. تحقق من صحة بيانات تسجيل الدخول
2. تأكد من صحة التوكن
3. تحقق من انتهاء صلاحية التوكن

### مشاكل البيانات
1. تحقق من schemas في الباك إند
2. تأكد من تطابق أسماء الحقول
3. تحقق من صحة JSON responses

## التطوير المستقبلي

### ميزات مقترحة
- إضافة دعم للصور
- تحسين واجهة المستخدم
- إضافة تقارير متقدمة
- دعم للنسخ الاحتياطي

### تحسينات الأداء
- إضافة cache للبيانات
- تحسين استعلامات قاعدة البيانات
- إضافة pagination للقوائم الطويلة

## الدعم
للحصول على المساعدة، يرجى مراجعة:
- ملفات README في مجلدات الباك إند والفرونت إند
- ملفات التوثيق في مجلد docs
- سجلات الأخطاء في console
